# Лабораторная работа №3 по DevOps "CI/CD" (часть 1)

## Задачи

1. Написать “плохой” CI/CD файл, который работает, но в нем есть не менее трех “bad practices” по написанию CI/CD
2. Написать “хороший” CI/CD, в котором эти плохие практики исправлены
3. В Readme описать каждую из плохих практик в плохом файле, почему она плохая и как в хорошем она была исправлена, как исправление повлияло на результат
4. Прочитать историю про Васю (она быстрая, забавная и того стоит): https://habr.com/ru/articles/689234/
5. Написать обычный отчет себе на гитхаб

*в данный момент нахожусь в пункете №5

### Выполнение лабы

Честно говоря, по сравнению с nginx, выполнение этой лабы протекало достаточно безболезненно. Я уже знала, что такое CI/CD из курса программирования в прошлом году. 
Там наш преподаватель заботливо настроил этот процесс в репозитории, и я имела удовольствие видеть красные крестики с ошибками в моём коде в самые неподходящие моменты (обычно за 2 часа до сдачи лабы). 
Здесь эту штуку предстояло написать мне самой.

То, что у меня получилось можно наблюдать в этом [плохом CI/CD файле](/lab3_simple/bad_practices.yml) и в [хорошем](/lab3_simple/corrected_file.yml). Во втором исправлены ошибки первого, по сути они не отличаются. 
А о том, какие ошибки там были и почему они таковыми являются рассказано ниже:

### Анализ Bad Practices CI/CD

| № | Bad Practice | Почему так делать не надо? | Исправление  | Влияние исправления |
| :--- | :--- | :--- | :--- | :--- |
| **1** | **Избыточные права:**<br> `permissions: contents: write pages: write` | **Нарушение Принципа Наименьших Привилегий (PoLP).** Данное разрешение `contents: write` даёт гиту возможность менять, добавлять и удалять код в вашем репозитории во всех ветках. Для деплоя статического сайта это соверешенно лишнее, исходный код нужно только читать. Кроме того, такие избыточные права являются большой угрозой безопасности. Если в рабочем процессе используется стороннее Action, которое вдруг окажется взломано, в ваши файлы может попасть вредооносный код, что испортит весь проект. | **Минимально необходимые права доступа:**<br>`permissions: contents: read pages: write id-token: write` | **Безопасность.** Даёт только нужные для работы процесса разрешения, а именно для чтения исходного кода, записи артефакта в служебную область Pages. Также было добавлено право `id-token: write`, которое позволяет сгенерировать или запросить токен OpenID Connect (OIDC), использующийся для аутентификации в облачных провайдерах и развертывания GitHub Pages.
| **2** | **Объединение задач:**<br>`build` и `deploy` записаны в одну `job` (`jobs: deploy)`. | **Отсутствие раграничения ответственности.** Объединение CI (тестирование/сборка) и CD (развертывание) приводит к некоторым проблемам. Если потребуется использовать разные окружениядля сборки и деплоя, то при установке конфигураций могут возникнуть конфликты (зависимостей, например). Также при возникновении ошибок будет непонятно, на каком этапе что-то пошло не так. | **Разделение на два задания:**<br>Разделение на `build` (CI) и `deploy` (CD), использование `Artifact` для передачи собранных файлов на развёртывание. | **Лучшая организация и мониторинг.** Задачи чётко разграничены, сразу видно, в какой момент возникла проблема. Кроме того, деплой начинается только после успешной сборки (`needs: build`), делая пайплайн более очевидным. |
| **3** | **Испоьзование устаревшей версии Action:**<br>`uses: actions/checkout@v2` | **Риски и неэффективность.** Устаревшие версии Actions имеют большую вероятность содержать уязвимости, а также они менее производительными и не всегда поддерживают последние функции GitHub. Кроме того, дальше в коде используются новые версии других `actions`, что может привести к конфликтам.| **Использование последней мажорной версии:**<br>`uses: actions/checkout@v4` | **Безопасность и Производительность.** Эта версия не будет конфликтовать с дальнейшими `actions` в коде, а также обеспечит наивысшую производительность и неуязвимость ко взлому кода. |
| **4** | **Ручной деплой:**<br>`git push -u origin HEAD:gh-pages --force` | **Устаревший ненадёжный метод.** Ручной `force push` (`--force`) очень опасен, он может привести к необратимой потере данных и повреждению истории ветки `gh-pages`. По сути данным действием мы принудительно перезаписываем код в ветке на то, что есть сейчас в последней версии. Если в каком-то файле произошла ошибка, он может быть уничтожен. Сейчас есть более безопасные методы у GitHub, к тому же не требующие ручной настройки. | **Использование специального Action:**<br>`uses: actions/deploy-pages@v4` | **Надёжность и современные стандарты.** Автоматический деплой при использовании Action, разработанного GitHub, намного безопаснее и не требует ручной настройки гита. Также GitHub регистрирует развертывание в среде репозитория и даёт возможность отката на предыдущую версию.

Написание ```yml-файлов``` состоит из ключевых слов, про которые я прочитала [здесь](https://docs.gitlab.com/ci/yaml/). 
Также я узнала, что в GitLab можно также создавать CI/CD пайплайны и они будут красиво отображаться в виде схемки.

### Анализ истории про Васю

Пока я читала эту статью, ко мне пришло осознание, что есть ещё куча терминов в IT, которые я не знаю, а потом, что, возможно, мне и не надо их знать, если не планирую становиться девопсером (а может и надо...). 
В целом история очень интересная, в некоторой степени даже поучительная. Признаюсь, я всё время ждала, пока этого Васю настигнет карма за его отношение к жизни и технологиям, 
поскольку здесь он представлен не самым высокоморальным и честным человеком и работником. Однако история закончилась хорощо для этого самого Васи и, возможно, мне стоит пересмотреть свои ценности (и перфекционизм). 

### Выводы по лабе (части 1)

Я узнала, что такое CI/CD и как самостоятельно писать ```yml-файлы``` на практике. 
Теперь если я буду делать какие-то пет-проекты, внедрю туда эти знания, чтобы не ломать свой старый код новым коммитом (это главное, что я вынесла из этой лабы).
